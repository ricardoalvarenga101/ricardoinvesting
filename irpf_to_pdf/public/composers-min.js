function composeOperationsFII(e,t,o){let a=0,c=0,n="";return _.map(e,((e,o)=>{switch(o){case TYPE_OPERATIONS_SELL.VENDA_DE_FII:n=o,e.amountValues>=0?a+=e.amountValues:(c+=e.amountValues,a+=e.amountValues,lossesSalesFii.hasOwnProperty(t)?lossesSalesFii[t]+=c:lossesSalesFii={[t]:c});break}})),n===TYPE_OPERATIONS_SELL.VENDA_DE_FII?a:null}function composeTableCommonOperationAndDayTrade(e){let t={};const o=Object.keys(e),a=o.length>0?o[0]:0;return _.map(e,((e,o)=>{t[o]={1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{},12:{},accumulatedCommon:0,accumulatedTrade:0},_.map(e,((e,c)=>{let n={commonList:[],dayTradeList:[],totalCommon:0,totalTrade:0};_.map(e,((e,t)=>{switch(t){case TYPE_OPERATIONS_SELL.SWING_TRADE:(e.amountTransaction>LIMIT_SWING_TRADE||e.amountValues<0)&&n.commonList.push(e);break;case TYPE_OPERATIONS_SELL.VENDA_DE_ETF:case TYPE_OPERATIONS_SELL.VENDA_DE_BDR:case TYPE_OPERATIONS_SELL.DIREITOS_DE_SUBSCRICAO:n.commonList.push(e);break;case TYPE_OPERATIONS_SELL.DAY_TRADE:n.dayTradeList.push(e);break}})),n.totalCommon=_.sumBy(n.commonList,"amountValues"),n.totalTrade=_.sumBy(n.dayTradeList,"amountValues"),t[o][c]=n,calcAccumulatedMonth(o,a,c,t)})),calcAccumulatedYear(o,a,t)})),t}function calcAccumulatedMonth(e,t,o,a){const c=a[e][o];if(e===t)a[e][o]="1"===o?{...c,accumulatedCommon:sumAccumulator(a,e,"totalCommon",o),accumulatedTrade:sumAccumulator(a,e,"totalTrade",o)}:{...c,accumulatedCommon:a[e][o-1].accumulatedCommon||0+sumAccumulator(a,e,"totalCommon",o),accumulatedTrade:a[e][o-1].accumulatedTrade||0+sumAccumulator(a,e,"totalTrade",o)};else{if(getLastOrFirstPositionYear(a,e,1).month==o){const t=a[e-1].accumulatedCommon,c=a[e-1].accumulatedTrade;a[e][o].accumulatedCommon=t+sumAccumulator(a,e,"totalCommon"),a[e][o].accumulatedTrade=c+sumAccumulator(a,e,"totalTrade")}else{const t=getOtherLastPosition(a,e,o);t.op.accumulatedCommon<0?a[e][o].accumulatedCommon=t.op.accumulatedCommon+sumAccumulator(a,e,"totalCommon"):a[e][o].accumulatedCommon=sumAccumulator(a,e,"totalCommon"),t.op.accumulatedTrade<0?a[e][o].accumulatedTrade=t.op.accumulatedTrade+sumAccumulator(a,e,"totalTrade"):a[e][o].accumulatedTrade=sumAccumulator(a,e,"totalTrade")}}const n=a[e][o].accumulatedCommon,l=a[e][o].accumulatedTrade;n>0&&(a[e][o].accumulatedCommon=0),l>0&&(a[e][o].accumulatedTrade=0)}function calcAccumulatedYear(e,t,o){e===t?(o[e].accumulatedCommon=sumAccumulator(o,e,"totalCommon"),o[e].accumulatedTrade=sumAccumulator(o,e,"totalTrade")):(o[e-1].accumulatedCommon<0?o[e].accumulatedCommon=o[e-1].accumulatedCommon+sumAccumulator(o,e,"totalCommon"):o[e].accumulatedCommon=sumAccumulator(o,e,"totalCommon"),o[e-1].accumulatedTrade<0?o[e].accumulatedTrade=o[e-1].accumulatedTrade+sumAccumulator(o,e,"totalTrade"):o[e].accumulatedTrade=sumAccumulator(o,e,"totalTrade"));const a=o[e].accumulatedCommon,c=o[e].accumulatedTrade;a>0&&(o[e].accumulatedCommon=0),c>0&&(o[e].accumulatedTrade=0)}function composeCommonOperationAndDayTrade(e,t,o,a,c=[],n){if(!c.includes(o))return null;let l=0,r=0;const u=c.indexOf(o),m=Object.keys(a),s=m.length>0?m[0]:0,d=convertCurrencyReal(convertCurrencyReal(e.totalCommon)),i=convertCurrencyReal(convertCurrencyReal(e.totalTrade));t!==s?0===u?(l=n[t-1].accumulatedCommon,r=n[t-1].accumulatedTrade):(l=n[t][c[u-1]].accumulatedCommon,r=n[t][c[u-1]].accumulatedTrade):0===u?(l=0,r=0):(l=n[t][c[u-1]].accumulatedCommon,r=n[t][c[u-1]].accumulatedTrade);const p=Math.abs(l)>=e.totalCommon?0:e.totalCommon-l,T=Math.abs(r)>=e.totalTrade?0:e.totalTrade-r,y=l>e.totalCommon?l-e.totalCommon:0,C=r>e.totalTrade?r-e.totalTrade:0;return{title:{pageBreak:"before",text:`\n\n${MONTHS_LABEL[o]} - ${t}`,style:"title"},content1:{style:"tableOperation",table:{widths:[200,"*","*"],body:[composeHeaderTable(["Resultados","Operações Comuns","Day-Trade"]),[{text:"Mercado à Vista - Ações",style:{color:"black"}},{text:d,style:{color:"blue",bold:!0}},{text:i,style:{color:"blue",bold:!0}}]]}},content2:{style:"tableOperation",table:{widths:[200,"*","*"],body:[composeHeaderTable(["Resultados","Operações Comuns","Day-Trade"]),[{text:"RESULTADO LÍQUIDO DO MÊS",style:{color:"black"}},{text:d,style:{color:"blue",bold:!0}},{text:convertCurrencyReal(0),style:{color:"blue",bold:!0}}],[{text:"Resultado negativo até o mês anterior",style:{color:"black"}},convertCurrencyReal(Math.abs(l)),convertCurrencyReal(r)],[{text:"BASE DE CÁLCULO DO IMPOSTO",style:{color:"black"}},{text:convertCurrencyReal(p),style:{color:"blue",bold:!0}},{text:convertCurrencyReal(T),style:{color:"blue",bold:!0}}],[{text:"Prejuízo a compensar",style:{color:"black"}},convertCurrencyReal(Math.abs(y)),convertCurrencyReal(C)],[{text:"Alíquota do imposto",style:{color:"black"}},{text:"15%",style:{color:"black"}},{text:"20%",style:{color:"black"}}],[{text:"IMPOSTO DEVIDO",style:{color:"black"}},{text:taxCal(p,.15),style:{color:"blue",bold:!0}},{text:taxCal(T,.2),style:{color:"blue",bold:!0}}]]}},content3:{style:"tableOperation",table:{widths:["*","*"],body:[composeHeaderTable([{text:"Consolidação do mês",colSpan:2},{}]),[{text:"Total do imposto devido",style:{color:"black"}},{text:convertCurrencyReal(.15*p+.2*T),style:{color:"blue",bold:!0}}],[{text:"IR fonte de Day-Trade no Mês",style:{color:"black"}},convertCurrencyReal(0)],[{text:"IR fonte de Day-Trade nos meses anteriores",style:{color:"black"}},convertCurrencyReal(0)],[{text:"IR fonte de Day-Trade a compensar",style:{color:"black"}},convertCurrencyReal(0)],[{text:"IR fonte (Lei nº 11.033/2004) no mês",style:{color:"black"}},convertCurrencyReal(0)],[{text:"IR fonte (Lei nº 11.033/2004) nos meses anteriores",style:{color:"black"}},convertCurrencyReal(0)],[{text:"IR fonte (Lei nº 11.033/2004) meses a compensar",style:{color:"black"}},convertCurrencyReal(0)],[{text:"Imposto a pagar",style:{color:"black"}},{text:convertCurrencyReal(.15*p+.2*T),style:{color:"blue",bold:!0}}],[{text:"Imposto pago",style:{color:"black"}},convertCurrencyReal(.15*p+.2*T)]]}}}}function composeAmountOperations(e){e.amountTransaction=_.sum(e.transactions),e.amountValues=_.sum(e.values)}function composeOperations(e,t,o,a){return e.hasOwnProperty(o)?e[o].hasOwnProperty(t)?e[o][t].hasOwnProperty(a.operation)?(e[o][t][a.operation].transactions.push(a.transaction),e[o][t][a.operation].values.push(a.value),composeAmountOperations(e[o][t][a.operation])):(e[o][t][a.operation]={transactions:[a.transaction],values:[a.value]},composeAmountOperations(e[o][t][a.operation])):(e[o][t]={[a.operation]:{transactions:[a.transaction],values:[a.value]}},composeAmountOperations(e[o][t][a.operation])):(e[o]={[t]:{[a.operation]:{transactions:[a.transaction],values:[a.value]}}},composeAmountOperations(e[o][t][a.operation])),e}function composeSwingTradeFree(e){_.map(e,((e,t)=>{let o=0;_.map(e,(e=>_.map(e,((e,a)=>{a!==TYPE_OPERATIONS_SELL.SWING_TRADE&&a!==TYPE_OPERATIONS_SELL.VENDA_DE_FI_INFRA||e.amountTransaction<=LIMIT_SWING_TRADE&&(o+=e.amountValues,SUM_SWING_TRADE_FREE[t]=o)}))))}))}function composeListYears(){const e=(new Date).getFullYear(),t=document.getElementById("year_select");let o="";for(let t=e;t>=firstYear;t--)o+=`<option value='${t}'> ${t}</option>`;t.innerHTML=o}function composeProvents(e){e&&e.hasOwnProperty("external")&&e.external;e&&e.hasOwnProperty("external")&&delete e.external;const t=Object.keys(e).sort(),o=[],a=[],c=[],n=[];return t.forEach((t=>{e[t].amountDividend&&o.push(["09",e[t].document_number_principal,e[t].name,convertCurrencyReal(e[t].amountDividend)]),e[t].amountJcp&&a.push(["10",e[t].document_number_principal,e[t].name,convertCurrencyReal(e[t].amountJcp||0)]),e[t].amountRendiment&&c.push(["99",e[t].document_number_principal,e[t].name,`Rendimentos de ${t} - (Administradora: ${e[t].admin?e[t].admin:e[t].document_number_principal})`,convertCurrencyReal(e[t].amountRendiment||0)]),e[t].amountRendimentJCP&&n.push(["12",e[t].document_number_principal,e[t].name,`Rendimentos tributados sobre juros recebidos de (${e[t].name})`,convertCurrencyReal(e[t].amountRendimentJCP)])})),{dividends:o,jcp:a,rendiments:c,rendimentsJCP:n}}function composeBensDireitos(){const e=[];return itensWalletFiltered.forEach((t=>{e.push([getCodes(t.classe).group,getCodes(t.classe).cod,getCodes(t.classe).locale,t.document_number_principal&&""!==t.document_number_principal?t.document_number_principal:t.document_number_admin,{text:t.description,style:"description"},t.past_year,t.this_year])})),e}function composeHeaderTable(e=[],t="#300668",o="white"){const a=[];return e.forEach((e=>{a.push({text:e,fillColor:t,color:o,style:{alignment:"center"}})})),a}